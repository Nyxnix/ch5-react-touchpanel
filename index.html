<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>buh</title>
    <script>
      // Prevent early native join callbacks from throwing before CrComLib is ready.
      var bridgeReceiveIntegerFromNative;
      var bridgeReceiveBooleanFromNative;
      var bridgeReceiveStringFromNative;
      var bridgeReceiveObjectFromNative;

      (function (global) {
        var queue = [];

        function forward(method, args) {
          var lib = global.CrComLib;
          if (lib && typeof lib[method] === 'function') {
            lib[method].apply(lib, args);
            return true;
          }
          return false;
        }

        function makeBridgeFn(method) {
          return function () {
            var args = Array.prototype.slice.call(arguments);
            if (!forward(method, args)) {
              queue.push({ method: method, args: args });
            }
          };
        }

        function replay() {
          if (!global.CrComLib) return;
          while (queue.length) {
            var item = queue.shift();
            forward(item.method, item.args);
          }
        }

        bridgeReceiveIntegerFromNative = makeBridgeFn('bridgeReceiveIntegerFromNative');
        bridgeReceiveBooleanFromNative = makeBridgeFn('bridgeReceiveBooleanFromNative');
        bridgeReceiveStringFromNative = makeBridgeFn('bridgeReceiveStringFromNative');
        bridgeReceiveObjectFromNative = makeBridgeFn('bridgeReceiveObjectFromNative');

        global.bridgeReceiveIntegerFromNative = bridgeReceiveIntegerFromNative;
        global.bridgeReceiveBooleanFromNative = bridgeReceiveBooleanFromNative;
        global.bridgeReceiveStringFromNative = bridgeReceiveStringFromNative;
        global.bridgeReceiveObjectFromNative = bridgeReceiveObjectFromNative;

        var replayTimer = global.setInterval(function () {
          if (!global.CrComLib) return;
          replay();
          global.clearInterval(replayTimer);
        }, 50);
      })(typeof globalThis !== 'undefined' ? globalThis : window);
    </script>
  </head>
  <body>
    <!-- Load Crestron runtime libraries first -->
    <script src="./index.js"></script>
    <script src="./cr-com-lib.js"></script>

    <div id="root"></div>
    <script type="module" src="./src/main.jsx"></script>
  </body>
</html>
